<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>后台管理</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="content-language" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="/static/lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="/static/css/login.css" media="all">
</head>
<body>
<div class="main-body">
    <div class="login-main">
        <div class="login-top">
            <span>Admin</span>
            <span class="bg1"></span>
            <span class="bg2"></span>
        </div>
        <form class="layui-form login-bottom">
            <div class="center">
                <div class="item">
                    <span class="icon icon-2"></span>
                    <input type="text" name="username" lay-verify="required" placeholder="请输入登录账号" maxlength="24" autocomplete="off"/>
                </div>
                <div class="item">
                    <span class="icon icon-3"></span>
                    <input type="password" name="password" lay-verify="required" placeholder="请输入密码" maxlength="20" autocomplete="off">
                    <span class="bind-password icon icon-4" title="显示/隐藏密码"></span>
                </div>

<!--                <div class="item">-->
<!--                    <span class="icon icon-1"></span>-->
<!--                    <label>-->
<!--                        <input type="text" name="code" placeholder="请输入谷歌验证码" maxlength="6" lay-verify="required|number" autocomplete="off">-->
<!--                    </label>-->
<!--                </div>-->

            </div>

            <div class="layui-form-item" style="text-align:center; width:100%;height:100%;margin:0px;">
                <button class="login-btn" lay-submit="" lay-filter="login">立即登录</button>
            </div>

        </form>
    </div>
</div>
<script src="/static/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="/static/js/md5.js" charset="utf-8"></script>

<script>
    layui.use(['form', 'jquery'], function() {
        var $ = layui.jquery, form = layui.form, layer = layui.layer;

        // 防止iframe嵌套
        if (top.location !== self.location) top.location = self.location;

        // 密码显示/隐藏切换
        $('.bind-password').on('click', function() {
            var input = $("input[name='password']");
            input.attr('type', input.attr('type') === 'password' ? 'text' : 'password');
            $(this).toggleClass('icon-5');
        });

        // 表单验证规则
        form.verify({
            username: function(value) {
                if(!value.trim()) return '用户名不能为空';
                if(/<[^>]+>/g.test(value)) return '用户名包含非法字符';
            },
            password: function(value) {
                if(!value.trim()) return '密码不能为空';
                if(value.length < 6) return '密码长度不能少于6位';
            },
            // code: function(value) {
            //     if(!value.trim()) return '验证码不能为空';
            //     if(!/^\d{6}$/.test(value)) return '验证码必须是6位数字';
            // }
        });

        // 登录提交
        form.on('submit(login)', function(data) {
            var btn = $('.login-btn');
            if(btn.hasClass('layui-btn-disabled')) return false;

            btn.addClass('layui-btn-disabled').text('登录中...');
            // 数据处理
            var formData = {
                username: data.field.username.replace(/<[^>]+>/g, ''),
                password: hex_md5(data.field.password)
            };

            $.post('/login/admin', formData, function(res) {
                if(res.code === 1) {
                    layer.msg("登录成功", {icon: 1}, function() {
                        window.location = '/admin/index';
                    });
                } else {
                    layer.msg(res.msg || '登录失败', {icon: 2});
                    btn.removeClass('layui-btn-disabled').text('立即登录');
                }
            }).fail(function() {
                layer.msg('网络错误', {icon: 2});
                btn.removeClass('layui-btn-disabled').text('立即登录');
            });

            return false;
        });
    });
</script>
</body>
</html>